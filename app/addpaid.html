<!DOCTYPE html>
<html lang="en">

<head>

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Twitter -->
  <meta name="twitter:site" content="@themepixels">
  <meta name="twitter:creator" content="@themepixels">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="DashForge">
  <meta name="twitter:description" content="Responsive Bootstrap 4 Dashboard Template">
  <meta name="twitter:image" content="http://themepixels.me/dashforge/img/dashforge-social.png">

  <!-- Facebook -->
  <meta property="og:url" content="http://themepixels.me/dashforge">
  <meta property="og:title" content="DashForge">
  <meta property="og:description" content="Responsive Bootstrap 4 Dashboard Template">

  <meta property="og:image" content="http://themepixels.me/dashforge/img/dashforge-social.png">
  <meta property="og:image:secure_url" content="http://themepixels.me/dashforge/img/dashforge-social.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="600">

  <!-- Meta -->
  <meta name="description" content="Responsive Bootstrap 4 Dashboard Template">
  <meta name="author" content="ThemePixels">

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="../assets/img/favicon.png">

  <title>DashForge Responsive Bootstrap 4 Dashboard Template</title>

  <!-- vendor css -->
  <link href="../lib/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="../lib/ionicons/css/ionicons.min.css" rel="stylesheet">
  <link href="../lib/jqvmap/jqvmap.min.css" rel="stylesheet">

  <!-- DashForge CSS -->
  <link rel="stylesheet" href="../assets/css/dashforge.css">
  <link rel="stylesheet" href="../assets/css/dashforge.dashboard.css">
</head>

<body>

  <aside class="aside aside-fixed">
    <div class="aside-header">
      <a href="index.html" class="aside-logo">dash<span>forge</span></a>
      <a href="" class="aside-menu-link">
        <i data-feather="menu"></i>
        <i data-feather="x"></i>
      </a>
    </div>
    <div class="aside-body">
      <div class="aside-loggedin">
        <div class="d-flex align-items-center justify-content-start">
          <a href="" class="avatar"><img src="" class="rounded-circle" alt="User" id="userIMG"></a>
          <div class="aside-alert-link">
            <a href="" data-toggle="tooltip" title="Sign out" onclick="Logout();"><i data-feather="log-out"></i></a>
          </div>
        </div>
        <div class="aside-loggedin-user">
          <a href="#loggedinMenu" class="d-flex align-items-center justify-content-between mg-b-2"
            data-toggle="collapse">
            <h6 class="tx-semibold mg-b-0"><span id="userSession"></span></h6>
            <i data-feather="chevron-down"></i>
          </a>
          <p class="tx-color-03 tx-12 mg-b-0" id="role"></p>
        </div>
        <div class="collapse" id="loggedinMenu">
          <ul class="nav nav-aside mg-b-0">
            <li class="nav-item"><a href="userprofile.html" class="nav-link"><i data-feather="edit"></i> <span>Editar
                  Perfil</span></a></li>
            <li class="nav-item"><a href="showprofile.html" class="nav-link"><i data-feather="user"></i> <span>Ver
                  Perfil</span></a></li>
            <li class="nav-item"><a href="changepass.html" class="nav-link"><i data-feather="settings"></i>
                <span>Cambiar Contraseña</span></a></li>
          </ul>
        </div>
      </div><!-- aside-loggedin -->
      <ul class="nav nav-aside">
        <li class="nav-label">Dashboard</li>
        <li class="nav-item"><a href="index.html" class="nav-link"><i data-feather="shopping-bag"></i>
            <span>Ventas</span></a></li>

        <li class="nav-label mg-t-25">Administración</li>
        <li class="nav-item with-sub">
          <a href="" class="nav-link"><i data-feather="user"></i> <span>Clientes</span></a>
          <ul>
            <li><a href="addcustomer.html">Registrar Cliente</a></li>
            <li><a href="listcustomers.html">Listado de Clientes</a></li>
          </ul>
        </li>
        <li class="nav-item with-sub active">
          <a href="" class="nav-link"><i data-feather="dollar-sign"></i> <span>Pagos</span></a>
          <ul>
            <li><a href="addpaid.html">Registrar Pago</a></li>
            <li><a href="listpaid.html">Listado de Pagos</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </aside>

  <div class="content ht-100v pd-0">
    <div class="content-header">
      <div class="content-search">
      </div>
      <nav class="nav">
        <a href="" class="nav-link"><i data-feather="help-circle"></i></a>
      </nav>
    </div><!-- content-header -->

    <div class="content-body">
      <div class="container pd-x-0">
        <div class="d-sm-flex align-items-center justify-content-between mg-b-20 mg-lg-b-25 mg-xl-b-30">
          <div>
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb breadcrumb-style1 mg-b-10">
                <li class="breadcrumb-item"><a href="#">Pagos</a></li>
                <li class="breadcrumb-item active" aria-current="page">Registrar Pago</li>
              </ol>
            </nav>
          </div>
        </div>

        <div class="row row-xs">
          <div class="media align-items-stretch justify-content-center ht-100p">
            <div class="sign-wrapper mg-lg-r-50 mg-xl-r-60">
              <div class="pd-t-20 wd-100p">
                <h4 class="tx-color-01 mg-b-5">Registrar Nuevo Pago</h4>
                <div class="search-form">
                  <input id="theBasics" type="search" class="form-control" placeholder="Escribir Correo">
                  <div class="form-group">
                    <input id="idCustomer" type="hidden" class="form-control">
                  </div>
                </div><br>
                <div class="form-group">
                  <input id="phone" type="number" class="form-control" disabled style="display: none;">
                </div>
                <div class="form-group">
                  <input id="fecha_pago" type="date" class="form-control" placeholder="Selecciona Fecha"
                    style="display: none;">
                </div>
                <div class="form-group">
                  <input id="fecha_vencimiento" type="date" class="form-control" placeholder="Selecciona Fecha"
                    style="display: none;">
                </div>
                <div class="form-group" style="display: none;" id="pagoInfo">
                  <select class="custom-select" id="pago">
                    <option selected value="0">Tipo de pago</option>
                    <option value="Efectivo">Efectivo</option>
                    <option value="Tarjeta">Tarjeta</option>
                    <option value="Transferencia">Transferencia</option>
                  </select>
                </div>
                <div class="form-group">
                  <input id="total" type="number" class="form-control" placeholder="$ Total a Pagar"
                    style="display: none;">
                </div>
                <div class="form-group">
                  <center><button class="btn btn-brand-02 btn-block" onclick="GetInfoUsr();" id="search_row"
                      style="display: none;">Buscar</button>
                  </center>
                </div>
                <div class="form-group">
                  <div role="alert" id="msg">
                  </div>
                </div>
              </div>
            </div><!-- sign-wrapper -->
            <div class="media-body pd-y-30 pd-lg-x-50 pd-xl-x-60 align-items-center d-none d-lg-flex pos-relative">
              <div class="mx-lg-wd-500 mx-xl-wd-550" id="divImg" style="display: none;">
                <img src="" class="img-fluid" alt="" id="img"><br><br>
                <center><button class="btn btn-brand-02 btn-block" onclick="ResgistrarPaid();">Registrar Pago</button>
                </center>
              </div>

            </div><!-- media-body -->
          </div><!-- media -->
        </div><!-- row -->
      </div><!-- container -->
    </div>
  </div>

  <script src="../lib/jquery/jquery.min.js"></script>
  <script src="../lib/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../lib/feather-icons/feather.min.js"></script>
  <script src="../lib/perfect-scrollbar/perfect-scrollbar.min.js"></script>
  <script src="../lib/chart.js/Chart.bundle.min.js"></script>
  <script src="../lib/typeahead.js/typeahead.bundle.min.js"></script>
  <script src="../assets/js/dashforge.js"></script>
  <script src="../assets/js/dashforge.aside.js"></script>
  <script src="../assets/js/dashforge.sampledata.js"></script>
  <script src="../assets/js/session.js"></script>

  <!-- append theme customizer -->
  <script src="../lib/js-cookie/js.cookie.js"></script>
  <script>
    $(function () {
      'use strict'
      var substringMatcher = function (strs) {
        return function findMatches(q, cb) {
          var matches, substrRegex;
          matches = [];
          substrRegex = new RegExp(q, 'i');

          $.each(strs, function (i, str) {
            if (substrRegex.test(str)) {
              matches.push(str);
            }
          });

          cb(matches);

          $('.tt-suggestion').on('click', function () {
            $('#search_row').show();
          });
        };
      };

      let http = new XMLHttpRequest();
      let result = [];
      let url = '../php/get_customers.php';
      let customers = "";
      let array = [];
      http.open('GET', url, true);
      http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

      http.onreadystatechange = function () {
        if (http.readyState == 4 && http.status == 200) {
          if (http.responseText != 1) {
            let datos = JSON.parse(http.responseText);
            let datosC = (datos['customers']);
            for (let i = 0; i < datosC.length; i++) {
              //array.push(datosC[i]['PHONE']+' - '+datosC[i]['EMAIL']);
              array.push(datosC[i]['EMAIL']);
            }

            $('#theBasics').typeahead({
              hint: true,
              highlight: true,
              minLength: 1
            },
              {
                name: 'array',
                source: substringMatcher(array)
              });

          } else if (http.responseText == 0) {
            msg.className = "alert alert-danger";
            msg.innerHTML = "No hay clientes registrados!.";
          } else {
            msg.className = "alert alert-danger";
            msg.innerHTML = "Ha ocurrido un error!.";
          }
        }
      }
      http.send(params);

    });

    function GetInfoUsr() {
      document.getElementById('fecha_pago').value = '';
      document.getElementById('fecha_vencimiento').value = '';
      document.getElementById('total').value = '';
      document.getElementById('pago').value = 0;
      $('#msg').hide();
      let http = new XMLHttpRequest();
      let email = document.getElementById('theBasics').value;
      let msg = document.getElementById("msg");
      let url = '../php/get_customer.php';
      let params = 'email=' + email;
      http.open('POST', url, true);
      http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

      http.onreadystatechange = function () {
        if (http.readyState == 4 && http.status == 200) {
          if (http.responseText != 0) {
            let info = (JSON.parse(http.responseText));
            document.getElementById('phone').value = info['PHONE'];
            document.getElementById('img').src = info['FOTO'];
            document.getElementById('idCustomer').value = info['ID_CUSTOM'];

            $('#phone').show();
            $('#fecha_pago').show();
            $('#fecha_vencimiento').show();
            $('#pagoInfo').show();
            $('#total').show();
            $('#divImg').show();

          } else if (http.responseText == 0) {
            msg.className = "alert alert-danger";
            msg.innerHTML = "Cliente no registrado!.";
          } else {
            msg.className = "alert alert-danger";
            msg.innerHTML = "Ha ocurrido un error!.";
          }
        }
      }
      http.send(params);
    }

    function ResgistrarPaid() {
      let idC = document.getElementById('idCustomer').value;
      let fecha_ini = document.getElementById('fecha_pago').value;
      let fecha_vencimiento = document.getElementById('fecha_vencimiento').value;
      let total = document.getElementById('total').value;
      let em = document.getElementById('theBasics').value;
      let pago = document.getElementById('pago').value;
      let msg = document.getElementById("msg");

      $('#msg').show();

      if (fecha_ini == '' && fecha_vencimiento == '' && total == '' && pago == 0) {
        msg.className = "alert alert-danger";
        msg.innerHTML = "Debes llenar los campos";
      }else if (fecha_ini == '') {
        msg.className = "alert alert-warning";
        msg.innerHTML = "Llenar fecha de pago";
      }else if (fecha_vencimiento == '') {
        msg.className = "alert alert-warning";
        msg.innerHTML = "Llenar fecha de vencimiento";
      }else if (pago == 0) {
        msg.className = "alert alert-warning";
        msg.innerHTML = "Seleccionar el tipo de pago";
      }else if (total == '') {
        msg.className = "alert alert-warning";
        msg.innerHTML = "Llenar el monto";
      }


    }

    function refresh() {
      window.location.reload();
    }
  </script>

</body>

</html>