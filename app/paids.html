<!DOCTYPE html>
<html lang="en">

<head>

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Twitter -->
  <meta name="twitter:site" content="@themepixels">
  <meta name="twitter:creator" content="@themepixels">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="DashForge">
  <meta name="twitter:description" content="Responsive Bootstrap 4 Dashboard Template">
  <meta name="twitter:image" content="http://themepixels.me/dashforge/img/dashforge-social.png">

  <!-- Facebook -->
  <meta property="og:url" content="http://themepixels.me/dashforge">
  <meta property="og:title" content="DashForge">
  <meta property="og:description" content="Responsive Bootstrap 4 Dashboard Template">

  <meta property="og:image" content="http://themepixels.me/dashforge/img/dashforge-social.png">
  <meta property="og:image:secure_url" content="http://themepixels.me/dashforge/img/dashforge-social.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="600">

  <!-- Meta -->
  <meta name="description" content="Responsive Bootstrap 4 Dashboard Template">
  <meta name="author" content="ThemePixels">

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="../assets/img/favicon.png">

  <title>DashForge Responsive Bootstrap 4 Dashboard Template</title>

  <!-- vendor css -->
  <link href="../lib/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="../lib/ionicons/css/ionicons.min.css" rel="stylesheet">
  <link href="../lib/jqvmap/jqvmap.min.css" rel="stylesheet">

  <!-- DashForge CSS -->
  <link rel="stylesheet" href="../assets/css/dashforge.css">
  <link rel="stylesheet" href="../assets/css/dashforge.dashboard.css">
</head>

<body>

  <aside class="aside aside-fixed">
    <div class="aside-header">
      <a href="index.html" class="aside-logo">dash<span>forge</span></a>
      <a href="" class="aside-menu-link">
        <i data-feather="menu"></i>
        <i data-feather="x"></i>
      </a>
    </div>
    <div class="aside-body">
      <div class="aside-loggedin">
        <div class="d-flex align-items-center justify-content-start">
          <a href="" class="avatar"><img src="" class="rounded-circle" alt="User" id="userIMG"></a>
          <div class="aside-alert-link">
            <a href="" data-toggle="tooltip" title="Sign out" onclick="Logout();"><i data-feather="log-out"></i></a>
          </div>
        </div>
        <div class="aside-loggedin-user">
          <a href="#loggedinMenu" class="d-flex align-items-center justify-content-between mg-b-2"
            data-toggle="collapse">
            <h6 class="tx-semibold mg-b-0"><span id="userSession"></span></h6>
            <i data-feather="chevron-down"></i>
          </a>
          <p class="tx-color-03 tx-12 mg-b-0" id="role"></p>
        </div>
        <div class="collapse" id="loggedinMenu">
          <ul class="nav nav-aside mg-b-0">
            <li class="nav-item"><a href="userprofile.html" class="nav-link"><i data-feather="edit"></i> <span>Editar
                  Perfil</span></a></li>
            <li class="nav-item"><a href="showprofile.html" class="nav-link"><i data-feather="user"></i> <span>Ver
                  Perfil</span></a></li>
            <li class="nav-item"><a href="changepass.html" class="nav-link"><i data-feather="settings"></i>
                <span>Cambiar Contraseña</span></a></li>
          </ul>
        </div>
      </div><!-- aside-loggedin -->
      <ul class="nav nav-aside">
        <li class="nav-label">Dashboard</li>
        <li class="nav-item"><a href="index.html" class="nav-link"><i data-feather="shopping-bag"></i>
            <span>Ventas</span></a></li>

        <li class="nav-label mg-t-25">Administración</li>
        <li class="nav-item with-sub">
          <a href="" class="nav-link"><i data-feather="user"></i> <span>Clientes</span></a>
          <ul>
            <li><a href="addcustomer.html">Registrar Cliente</a></li>
            <li><a href="listcustomers.html">Listado de Clientes</a></li>
          </ul>
        </li>
        <li class="nav-item with-sub active">
          <a href="" class="nav-link"><i data-feather="dollar-sign"></i> <span>Pagos</span></a>
          <ul>
            <li><a href="addpaid.html">Registrar Pago</a></li>
            <li><a href="paids.html">Listado de Pagos</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </aside>

  <div class="content ht-100v pd-0">
    <div class="content-header">
      <div class="content-search">
      </div>
      <nav class="nav">
        <a href="" class="nav-link"><i data-feather="help-circle"></i></a>
      </nav>
    </div><!-- content-header -->

    <div class="content-body">
      <div class="container pd-x-0">
        <div class="d-sm-flex align-items-center justify-content-between mg-b-20 mg-lg-b-25 mg-xl-b-30">
          <div>
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb breadcrumb-style1 mg-b-10">
                <li class="breadcrumb-item"><a href="#">Pagos</a></li>
                <li class="breadcrumb-item active" aria-current="page">Listado de Pagos</li>
              </ol>
            </nav>
            <h4 class="mg-b-0 tx-spacing--1">En este apartado puedes ver y editar los pagos.</h4>
          </div>
        </div>

        <div class="modal fade" id="modal6" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel6"
          aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content tx-14">
              <div class="modal-header">
                <h6 class="modal-title" id="exampleModalLabel6">EDITAR PAGO</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <div class="form-group">
                  <input id="name" type="text" class="form-control" disabled>
                </div>
                <div class="form-group">
                  <input id="email" type="email" class="form-control" disabled>
                </div>
                <div class="form-group">
                  <input id="fechaP" type="date" class="form-control">
                </div>
                <div class="form-group">
                  <input id="fechaV" type="date" class="form-control">
                </div>
                <div class="form-group">
                  <input id="monto" type="number" class="form-control">
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary tx-13" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary tx-13">Save changes</button>
              </div>
            </div>
          </div>
        </div>

        <div class="row row-xs">
          <div data-label="Example" class="df-example demo-table">
            <table id="paids" class="table">
            </table>
          </div>
        </div><!-- row -->
      </div><!-- container -->
    </div>
  </div>

  <script src="../lib/jquery/jquery.min.js"></script>
  <script src="../lib/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../lib/feather-icons/feather.min.js"></script>
  <script src="../lib/perfect-scrollbar/perfect-scrollbar.min.js"></script>
  <script src="../lib/datatables.net/js/jquery.dataTables.min.js"></script>
  <script src="../lib/datatables.net-dt/js/dataTables.dataTables.min.js"></script>
  <script src="../lib/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
  <script src="../lib/datatables.net-responsive-dt/js/responsive.dataTables.min.js"></script>
  <script src="../lib/chart.js/Chart.bundle.min.js"></script>

  <script src="../assets/js/dashforge.js"></script>
  <script src="../assets/js/dashforge.aside.js"></script>
  <script src="../assets/js/dashforge.sampledata.js"></script>
  <script src="../assets/js/session.js"></script>

  <!-- append theme customizer -->
  <script src="../lib/js-cookie/js.cookie.js"></script>

  <script>
    $(function () {
      'use strict'
      var table = $('#paids').DataTable({
        "columns": [{
          "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
          "title": "ID",
          "data": "ID_PAID"
        },
        {
          "title": "ID CLIENTE",
          "data": "ID_CUSTOM"
        },
        {
          "title": "NOMBRE",
          "data": "NAME"
        },
        {
          "title": "EMAIL",
          "data": "EMAIL"
        },
        {
          "title": "FECHA DE PAGO",
          "data": "FECHA_FIN"
        },
        {
          "title": "FECHA DE VENCIMIENTO",
          "data": "FECHA_FIN"
        },
        {
          "title": "ESTADO",
          "data": "ESTADO"
        },
        {
          "title": "TIPO DE PAGO",
          "data": "TIPO_PAGO"
        },
        {
          data: null,
          defaultContent: '<a href="#modal6" class="fa fa-pen Edit" data-toggle="modal" data-animation="effect-newspaper"></a>',
          orderable: false
        },
        {
          data: null,
          defaultContent: '<i class="fa fa-trash"/>',
          orderable: false
        }
        ],
        rowCallback: function (row, data, index) {
          if (data['ESTADO'] == 'ACTIVO') {
            $(row).find('td:eq(6)').css('color', 'green');
            $(row).find('td:eq(6)').css('font-family', 'fantasy');
          } else if (data['ESTADO'] == 'VENCIDO') {
            $(row).find('td:eq(6)').css('color', 'red');
            $(row).find('td:eq(6)').css('text-decoration', 'line-through');
            $(row).find('td:eq(6)').css('font-family', 'fantasy');
          }
        }
      });

      let http = new XMLHttpRequest();
      let url = '../php/get_paids.php';
      http.open('GET', url, true);
      http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

      http.onreadystatechange = function () {
        if (http.readyState == 4 && http.status == 200) {
          if (http.responseText != '') {
            let datos = JSON.parse(http.responseText);
            table.rows.add(datos['customers']).draw();
            const customers = datos['customers'].map(function (custom) {
              return custom.ID_CUSTOM;
            });

            for (let e = 0; e < customers.length; e++) {
              var elementsList = document.querySelectorAll('.Edit');
              for (var i = 0; i < elementsList.length; i++) {
                elementsList[i].setAttribute('mon', customers[i]);
              }
            }

          } else if (http.responseText == 0) {
            msg.className = "alert alert-danger";
            msg.innerHTML = "No hay clientes registrados!.";
          } else {
            msg.className = "alert alert-danger";
            msg.innerHTML = "Ha ocurrido un error!.";
          }
        }
      }
      http.send();

      $('#modal6').on('show.bs.modal', function (event) {
        var animation = $(event.relatedTarget).data('animation');
        $(this).addClass(animation);
      })

      // hide modal with effect
      $('#modal6').on('hidden.bs.modal', function (e) {
        $(this).removeClass(function (index, className) {
          return (className.match(/(^|\s)effect-\S+/g) || []).join(' ');
        });
      });

    });
  </script>


</body>

</html>